<!DOCTYPE html>
<meta charset="utf-8">
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://bl.ocks.org/syntagmatic/raw/3341641/render-queue.js"></script>
    <h1 align="center"><font size="80">Ted Talk Timeline</font></h1>
    <p style="margin-left:30em;margin-right:30em;"><font size="4">TED started as an annual, invite-only conference in 1984, but has since morphed into a global brand. Since 2006, TED.com has become a hub for thought-provoking ideas delivered by some of the world's brightest minds. With more than 2,500 talks recorded since its inception, the TED library continues to grow. Topics range from the future of the internet, to living stress-free, to even a love poem for lonely prime numbers.</font> </p>
    <p style="margin-left:40em;margin-right:40em;"><b><font size="5"> Top Topics Included are </font></b></p>
    <p style="margin-left:30em;margin-right:30em;"><font size="5"color="red">Architect, Artist, Designer, Engineer, Entrepreneur, Inventor, Musician,
        Photographer, Writer, Actor, Activist, Physicist</font></p>
</head>
<style>
    
    .parcoords {
        display: block;
        /* background-color: lightblue; */
      }

    .parcoords svg,
    .parcoords canvas {
        font: 10px sans-serif;
        position: absolute;

    }

    .parcoords canvas {
        opacity: 0.9;
        pointer-events: none;
        background-image: url("TED3.jpg");
        background-size: 1200px 600px;
    }

    .axis .title {
        font-size: 15px;
        transform: rotate(-21deg) translate(-5px, -6px);
        fill: #000000;
    }

    .axis line,
    .axis path {
        fill: none;
        stroke: #ccc;
        stroke-width: 1px;
    }

    .axis .tick text {
        fill: #222;
        opacity: 0;
        pointer-events: none;
    }

    .axis.manufac_name .tick text,
    .axis.food_group .tick text {
        opacity: 1;
    }

    .axis:hover line,
    .axis:hover path,
    .axis.active line,
    .axis.active path {
        fill: none;
        stroke: #222;
        stroke-width: 1px;

    }

    .axis:hover .title {
        font-weight: bold;
    }

    .axis:hover .tick text {
        opacity: 1;
    }

    .axis.active .title {
        font-weight: bold;
    }

    .axis.active .tick text {
        opacity: 1;
        font-weight: bold;
    }

    .brush .extent {
        fill-opacity: .3;
        stroke: #fff;
        stroke-width: 1px;

    }

    pre {
        width: 80%;
        height: 200px;
        margin: 30px 100px;
        tab-size: 50;
        font-size: 10px;
        overflow: auto;
        background-color: black ;
        color: white;
        /* background-color: coral; */
    }

    .tooltip {
        position: absolute;
        font: 15px sans-serif;
        width: 150px;
        height: 35px;
        pointer-events: none;

    }
    h1 {
        text-shadow: 3px 2px red;
    }


    div.absolute {
        position: absolute;
        top: 70px;
        right:0;
        left: 500;
        width: 480px;
        height: 100px;
        color: orange;
        font-size: 20px;
        font-family:fantasy;
        /* text-shadow: 3px 2px red; */
    }
    div.absolute1 {
        position: absolute;
        top: 160px;
        right:0;
        left: 500;
        width: 480px;
        height: 100px;
        color: black;
        font-size: 30px;
        font-family:inherit;
    }
    input[type=text] {
    width: 1400px;
    height: 100px;
    align-items: center;
    padding: 12px 20px;
    margin: 8px 0;
    color: red;
    border: none;
    text-align: center;
    font-size: 50px;
    background-color: black ;
  }
  ul.b {
    list-style-type: square;
    position: absolute;
    top: 205px;
    right:0;
    left: 500;
    width: 480px;
    height: 100px;
    /* color: black; */
    font-size: 20px;
    font-family: monospace;
  }
  ul:nth-child(1): b {
  color: green;
}

ul:nth-child(2): b {
  color: red;
}

ul:nth-child(3): b {
  color: blue;
}
body {
    background-color: black ;
    color: white;
}
</style>

<div class="row">
    <div class="col-md-4" id="area1"></div>
</div>
<div class="row">
    <div class="col-md-12" id="area2"></div>
</div>
  <!-- <div class="absolute">This website shows information about different TED Talks uploaded to the official TED.com website until September 21st, 2017.
  </div>
  <div  class="absolute1">Topics included are</div>
  <ul class="b">
        <li>Architect</li>
        <li>Artist</li>
        <li>Designer</li>
        <li>Engineer</li>
        <li>Entrepreneur</li>
        <li>Inventor</li>
        <li>Musician</li>
        <li>Photographer</li>
        <li>Writer</li>
        <li>Actor</li>
        <li>Activist</li>
        <li>Physicist</li>
</ul> -->

<body>

  <!-- <div class="absolute">This website shows information about different TED Talks uploaded to the official TED.com website until September 21st, 2017. -->
    <!-- </div> -->
    <!-- <div  class="absolute1">Topics included are</div>
    <ul class="b">
          <li>Architect</li>
          <li>Artist</li>
          <li>Designer</li>
          <li>Engineer</li>
          <li>Entrepreneur</li>
          <li>Inventor</li>
          <li>Musician</li>
          <li>Photographer</li>
          <li>Writer</li>
          <li>Actor</li>
          <li>Activist</li>
          <li>Physicist</li>
  </ul> -->
    <script>
        var filteredData = [];

        function transformData(data) {
            var newData = [];
            data.forEach(function (d) {
                newData.push({
                    occupation: d.key,
                    year: d.year,
                    view: +d.value,
                    speaker: d.main_speaker,
                    comments: +d.comments,
                    title: d.title,
                    url: d.url,
                    eventdata: d.event,
                    duration: +d.duration_min,
                    ratings: d.ratings
                });
            })
            return newData;
        }

        function addMissingValues(data) {
            var occupationList = ["Architect", "Artist", "Designer", "Engineer", "Entrepreneur", "Inventor", "Musician",
                "Photographer", "Writer", "Actor", "Activist", "Physicist"
            ];
            var presentYear = [];
            var yearList = ["2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016",
                "2017"
            ]
            for (var i = 0; i < occupationList.length; i++) {
                presentYear = [];
                for (var j = 0; j < data.length; j++) {
                    if (occupationList[i] == data[j].occupation) {
                        presentYear.push(data[j].year);
                    }
                }

                for (var k = 0; k < yearList.length; k++) {
                    var flag = 0;
                    for (var l = 0; l < presentYear.length; l++) {
                        if (yearList[k] == presentYear[l]) {
                            flag = 1;
                        }
                    }
                    if (flag == 0) {
                        data.push({
                            occupation: occupationList[i],
                            year: yearList[k],
                            view: 0,
                            speaker: '',
                            comments: 0,
                            title: '',
                            url: '',
                            eventdata: '',
                            duration: 0,
                            ratings: ''
                        })
                    }
                }
            }
            return data;

        }


        d3.csv('newData.csv', function (err, inputData) {
            if (err) console.log(err);

            var flatData = transformData(inputData);

            filteredData1 = flatData.filter(function (data) {
                return data.occupation == "Architect" ||
                    data.occupation == "Artist" ||
                    data.occupation == "Designer" ||
                    data.occupation == "Engineer" ||
                    data.occupation == "Entrepreneur" ||
                    data.occupation == "Inventor" ||
                    data.occupation == "Musician" ||
                    data.occupation == "Photographer" ||
                    data.occupation == "Writer" ||
                    data.occupation == "Actor" ||
                    data.occupation == "Activist" ||
                    data.occupation == "Physicist";
            });

            filteredData = addMissingValues(filteredData1);

            var nested_data = d3.nest()
                .key(function (d) {
                    return d.year;
                })
                .entries(filteredData);


            var mqpdata = nested_data.map(function (d) {
                var obj = {
                    month: new Date(d.key, 0, 1)
                }

                d.values.forEach(function (v) {
                    obj[v.occupation] = v.view;
                })

                return obj;
            })
            buildStreamGraph(mqpdata);

        })

        function drawParallelCoordinates(key) {
            filterData = filteredData.filter(function (data) {
                return data.occupation == key

            });

            var margin = {
                    top: 50,
                    right: 100,
                    bottom: 20,
                    left: 100
                },
                width = screen.width - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom,
                innerHeight = height - 2;

            var devicePixelRatio = window.devicePixelRatio || 1;

            var color = d3.scaleOrdinal()
                .range(["#5DA5B3", "#D58323", "#DD6CA7", "#54AF52", "#8C92E8", "#E15E5A", "#725D82", "#776327",
                    "#50AB84", "#954D56", "#AB9C27", "#517C3F", "#9D5130", "#357468", "#5E9ACF", "#C47DCB",
                    "#7D9E33", "#DB7F85", "#BA89AD", "#4C6C86", "#B59248", "#D8597D", "#944F7E", "#D67D4B",
                    "#8F86C2"
                ]);

            var types = {
                "Number": {
                    key: "Number",
                    coerce: function (d) {
                        return +d;
                    },
                    extent: d3.extent,
                    within: function (d, extent, dim) {
                        return extent[0] <= dim.scale(d) && dim.scale(d) <= extent[1];
                    },
                    defaultScale: d3.scaleLinear().range([innerHeight, 0])
                },
                "String": {
                    key: "String",
                    coerce: String,
                    extent: function (data) {
                        return data.sort();
                    },
                    within: function (d, extent, dim) {
                        return extent[0] <= dim.scale(d) && dim.scale(d) <= extent[1];
                    },
                    defaultScale: d3.scalePoint().range([0, innerHeight])
                },
                "Date": {
                    key: "Date",
                    coerce: function (d) {
                        return new Date(d);
                    },
                    extent: d3.extent,
                    within: function (d, extent, dim) {
                        return extent[0] <= dim.scale(d) && dim.scale(d) <= extent[1];
                    },
                    defaultScale: d3.scaleTime().range([0, innerHeight])
                }
            };

            var dimensions = [{
                    key: "year",
                    description: "Year",
                    type: types["String"]
                },
                // {
                //     key: "url",
                //     description: "Url",
                //     type: types["String"],
                //     // axis: d3.axisRight()
                //     //     .tickFormat(function (d, i) {
                //     //         if (d == null) return "(null)";
                //     //         return i % 5 == 0 ? d.slice(0, 22) : "";
                //     //     })
                //
                // },
                {
                    key: "view",
                    type: types["Number"],
                    scale: d3.scaleSqrt().range([innerHeight, 0])
                },
                {
                    key: "speaker",
                    description: "speaker",
                    type: types["String"],
                    axis: d3.axisRight()
                        .tickFormat(function (d, i) {
                            if (d == null) return "(null)";
                            return i % 5 == 0 ? d.slice(0, 22) : "";
                        })
                },
                {
                    key: "comments",
                    type: types["Number"],
                    scale: d3.scaleSqrt().range([innerHeight, 0])
                },
                {
                    key: "eventdata",
                    description: "Event",
                    type: types["String"],
                    axis: d3.axisRight()
                        .tickFormat(function (d, i) {
                            if (d == null) return "(null)";
                            return i % 5 == 0 ? d.slice(0, 22) : "";
                        })

                }
                // {
                //     key: "title",
                //     description: "Title",
                //     type: types["String"],
                //     // axis: d3.axisLeft()
                //     //     .tickFormat(function (d, i) {
                //     //         return d;
                //     //     })
                // }
            ];

            var xscale = d3.scalePoint()
                .domain(d3.range(dimensions.length))
                .range([0, width]);

            var yAxis = d3.axisLeft();

            var container = d3.select("#area2").append("div")
                .attr("id", "parallelSVG")
                .attr("class", "parcoords")
                .style("width", width + margin.left + margin.right + "px")
                .style("height", height + margin.top + margin.bottom + "px");

            var svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


            var canvas = container.append("canvas")
                .attr("width", width * devicePixelRatio)
                .attr("height", height * devicePixelRatio)
                .style("width", width + "px")
                .style("height", height + "px")
                .style("margin-top", margin.top + "px")
                .style("margin-left", margin.left + "px");

            var ctx = canvas.node().getContext("2d");
            ctx.globalCompositeOperation = 'darken';
            ctx.globalAlpha = 0.15;
            ctx.lineWidth = 1.5;
            ctx.scale(devicePixelRatio, devicePixelRatio);

            var output = d3.select("#area2").append("pre").attr("id", "parallelText");
            var tooltip = d3.select("#area2").append("div")
                .attr("class", "tooltip");

            var axes = svg.selectAll(".axis")
                .data(dimensions)
                .enter().append("g")
                .attr("class", function (d) {
                    return "axis " + d.key.replace(/ /g, "_");
                })
                .attr("transform", function (d, i) {
                    return "translate(" + xscale(i) + ")";
                })

            // shuffle the data!
            data = d3.shuffle(filterData);
            allUrl = []
            var map1 = new Map();
            data.forEach(function (d) {
                dimensions.forEach(function (p) {
                    d[p.key] = !d[p.key] ? null : p.type.coerce(d[p.key]);
                    map1.set(d['url'], d['title']);
                });

                // truncate long text strings to fit in data table
                for (var key in d) {
                    if (d[key] && d[key].length > 35) d[key] = d[key].slice(0, 1000);

                }
            });

            map1.forEach(function (item, key, mapObj) {
                openVideo(key, item)
                drawBarChart(item)

                // console.log(item.toString() + "<br />");
            });

            var stack = d3.stack()
                .keys(allUrl)
                .order(d3.stackOrderNone)
                .offset(d3.stackOffsetWiggle);
            //
            var series = stack(filterData);

            // type/dimension default setting happens here

            dimensions.forEach(function (dim) {
                if (!("domain" in dim)) {
                    // detect domain using dimension type's extent function
                    dim.domain = d3_functor(dim.type.extent)(data.map(function (d) {
                        return d[dim.key];
                    }));
                }
                if (!("scale" in dim)) {
                    // use type's default scale for dimension
                    dim.scale = dim.type.defaultScale.copy();
                }
                dim.scale.domain(dim.domain);


            });


            var render = renderQueue(draw).rate(50);

            ctx.clearRect(0, 0, width, height);
            ctx.globalAlpha = d3.min([0.85 / Math.pow(data.length, 0.3), 1]);
            render(data);

            axes.append("g")
                .each(function (d) {
                    var renderAxis = "axis" in d ?
                        d.axis.scale(d.scale) // custom axis
                        :
                        yAxis.scale(d.scale); // default axis
                    d3.select(this).call(renderAxis);
                })
                .append("text")
                .attr("class", "title")
                .attr("text-anchor", "start")
                .text(function (d) {
                    return "description" in d ? d.description : d.key;
                })



            // Add and store a brush for each axis.
            axes.append("g")
                .attr("class", "brush")
                .each(function (d) {
                    d3.select(this).call(d.brush = d3.brushY()
                        .extent([
                            [-10, 0],
                            [10, height]
                        ])
                        .on("start", brushstart)
                        .on("brush", brush)
                        .on("end", brush)

                    )
                })
                .selectAll("rect")
                .attr("x", -8)
                .attr("width", 16)
                .on("mouseover", mouseover)
                .on("mouseout", mouseout);


            d3.selectAll(".axis.occupation .tick text")
                .style("fill", color);


            // d3.selectAll(".axis text")


            var projection = svg.selectAll(".background path,.foreground path")
                .on("mouseover", mouseover)
                .on("mouseout", mouseout);


            function mouseover(d) {

            }

            function mouseout(d) {
                svg.classed("active", false);
                projection.classed("inactive", false);
                axes.classed("inactive", false);
            }

            function moveToFront() {
                this.parentNode.appendChild(this);
            }

            output.text(d3.tsvFormat(data.slice(0, 100)));

            // console.log(data.url);

            function project(d) {
                return dimensions.map(function (p, i) {
                    // check if data element has property and contains a value
                    if (!(p.key in d) ||
                        d[p.key] === null
                    ) return null;

                    return [xscale(i), p.scale(d[p.key])];
                });
            };

            function draw(d) {
                ctx.strokeStyle = color(d.speaker);
                ctx.beginPath();
                var coords = project(d);
                coords.forEach(function (p, i) {
                    // this tricky bit avoids rendering null values as 0
                    if (p === null) {
                        // this bit renders horizontal lines on the previous/next
                        // dimensions, so that sandwiched null values are visible
                        if (i > 0) {
                            var prev = coords[i - 1];
                            if (prev !== null) {
                                ctx.moveTo(prev[0], prev[1]);
                                ctx.lineTo(prev[0] + 6, prev[1]);
                            }
                        }
                        if (i < coords.length - 1) {
                            var next = coords[i + 1];
                            if (next !== null) {
                                ctx.moveTo(next[0] - 6, next[1]);
                            }
                        }
                        return;
                    }

                    if (i == 0) {
                        ctx.moveTo(p[0], p[1]);
                        return;
                    }

                    ctx.lineTo(p[0], p[1]);

                });
                ctx.stroke();
            }

            function brushstart() {
                d3.event.sourceEvent.stopPropagation();
            }

            // Handles a brush event, toggling the display of foreground lines.
            function brush() {
                render.invalidate();

                var actives = [];
                svg.selectAll(".axis .brush")
                    .filter(function (d) {
                        return d3.brushSelection(this);
                    })
                    .each(function (d) {
                        // if (dim.key == 'url') testUrls.push(d[dim.key]);
                        actives.push({
                            dimension: d,
                            extent: d3.brushSelection(this)
                        })
                    })

                testUrls = []
                var selected = data.filter(function (d) {
                    // console.log(selected)
                    if (actives.every(function (active) {
                            var dim = active.dimension;
                            // test if point is within extents for each active brush
                            return dim.type.within(d[dim.key], active.extent, dim);
                        })) {
                        return true;
                    }
                });

                // testUrls.forEach(function (urltest) {
                //   openVideo(urltest)
                //   // console.log(urltest);
                // });

                ctx.clearRect(0, 0, width, height);
                ctx.globalAlpha = d3.min([0.85 / Math.pow(selected.length, 0.3), 1]);
                render(selected);
                // console.log(selected.speaker)
                output.text(d3.tsvFormat(selected.slice(0, 100)));
                // console.log(output.text(d3.tsvFormat(selected.slice(0, 24))))
            }

            function d3_functor(v) {
                return typeof v === "function" ? v : function () {
                    return v;
                };
            };
        }

        function position(d) {
            var v = dragging[d];
            return v == null ? x(d) : v;
        }

        function transition(g) {
            return g.transition().duration(500);
        }

        // Returns the path for a given data point.
        function path(d) {
            return line(dimensions.map(function (p) {
                return [position(p), y[p](d[p])];
            }));
        }

        function brushstart() {
            d3.event.sourceEvent.stopPropagation();
        }

        // Handles a brush event, toggling the display of foreground lines.
        function brush() {
            var actives = dimensions.filter(function (p) {
                    return !y[p].brush.empty();
                }),
                extents = actives.map(function (p) {
                    return y[p].brush.extent();
                });
            foreground.style("display", function (d) {
                return actives.every(function (p, i) {
                    return extents[i][0] <= d[p] && d[p] <= extents[i][1];
                }) ? null : "none";
            });
        }

        function drawBarChart(key) {
            // console.log(key);
            selectData = filteredData.filter(function (data) {
                return data.occupation == key
            });
            // console.log(selectData);
            var margin = {
                    top: 30,
                    right: 20,
                    bottom: 200,
                    left: 80
                },
                width = screen.width - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;
            var x = d3.scaleBand()
                .range([0, width], .1);
            var y = d3.scaleLinear()
                .range([height, 0]);
            var xAxis = d3.axisBottom(x);
            var yAxis = d3.axisLeft(y)
                .ticks(10);
            var svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            x.domain(selectData.map(function (d) {
                    return d.speaker;
                }))
                .paddingInner(0.1)
                .paddingOuter(0.5);
            y.domain([0, d3.max(selectData, function (d) {
                return d.comments;
            })]);
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("font-family", "sans-serif")
                .attr("font-size", "15px")
                .attr("transform", "rotate(-45)");
            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .text("Comments")
                .style("text-anchor", "end")
                .selectAll("text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "10px");
            svg.selectAll(".bar")
                .data(selectData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function (d) {
                    return x(d.speaker);
                })
                .attr("width", x.bandwidth())
                .attr("y", function (d) {
                    return y(d.comments);
                })
                .attr("height", function (d) {
                    return height - y(d.comments);
                });
        }


        function openVideo(key, value) {
            if (value != null && key != null) {
                // console.log(actives);
                var svg = d3.select("body").append("svg")
                    .attr("width", screen.width)
                    .attr("height", 200);
                svg.append("foreignObject")
                    .attr("width", 480)
                    .attr("height", 500)
                    .append("xhtml:body")
                    .style("font", "14px 'Helvetica Neue'")
                    .html("<a href='" + key + "'>" + value + "</a>");
            }
        }

        function buildStreamGraph(mqpdata) {
            var data = mqpdata;

            var stack = d3.stack()
                .keys(["Architect", "Artist", "Designer", "Engineer", "Entrepreneur", "Inventor", "Musician",
                    "Photographer", "Writer", "Actor", "Activist", "Physicist"
                ])
                .order(d3.stackOrderNone)
                .offset(d3.stackOffsetWiggle);

            var series = stack(data);


            var margin = {
                    top: 50,
                    right: 10,
                    bottom: 10,
                    left: 100
                },
                width = screen.width - margin.left - margin.right,
                height = 600 - margin.top - margin.bottom;

            // var width = 1200,
            //     height = 500;

            var x = d3.scaleTime()
                .domain(d3.extent(data, function (d) {
                    return d.month;
                }))
                .range([100, width - 50]);

            // setup axis
            var xAxis = d3.axisBottom(x);

            var y = d3.scaleLinear()
                .domain([0, d3.max(series, function (layer) {
                    return d3.max(layer, function (d) {
                        return d[0] + d[1];
                    });
                })])
                .range([height / 2, -100]);

            var color = d3.scaleLinear()
                .range(["#51D0D7", "#31B5BB"]);

            var color = d3.scaleOrdinal(d3.schemeCategory20);

            var area = d3.area()
                .x(function (d) {
                    // console.info('in area function', d);
                    return x(d.data.month);
                })
                .y0(function (d) {
                    return y(d[0]);
                })
                .y1(function (d) {
                    return y(d[1]);
                })
                .curve(d3.curveBasis);

            var tooltip = d3.select("#area1").append("div")
                .attr("class", "tooltip");

            var svg = d3.select("#area1").append("svg")
                .attr("id", "streamSVG")
                .attr("width", width)
                .attr("height", height);

            svg.append("g")
                .attr("class", "axis axis--x")
                .attr("transform", "translate(0," + (height) + ")")
                .call(xAxis);

            var xAxisGroup = svg.append("g").call(xAxis);

            svg.selectAll("path")
                .data(series)
                .enter().append("path")
                .attr("d", area)
                .style("fill", function () {
                    return color(Math.random());
                })
                .on('mouseover', function (d) {
                    d3.select(this).style('fill', d3.rgb(d3.select(this).style("fill")).brighter());
                    d3.select("#major").text(d.key);
                    tooltip.transition()
                        .duration(700)
                        .style("opacity", 1);
                    tooltip.html(d.key)
                        .style("left", (d3.event.pageX + 5) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on('mouseout', function (d) {
                    d3.select(this).style('fill',
                        d3.rgb(d3.select(this).style("fill")).darker());
                    d3.select("#major").text("Mouse over");
                    tooltip.transition()
                        .duration(700)
                        .style("opacity", 0);
                })
                .on('click', function (d) {
                    var selected = d.key;
                    // console.log(d);

                    svg.append("foreignObject")
                    .attr("x", 0)
                    .attr("y", function() { return 50*8 })
                    .attr("width", 140)
                    .attr("height", 50)
                    .html(function(d) {
                      return  ("<input type=\"text\" value ="+ selected +">")
                    })

                    if (d3.select("#parallelSVG")) {
                        d3.select("#parallelSVG").remove();
                        d3.select("#parallelText").remove();
                    }

                    //  console.log(selected);
                    //   tooltip.remove();
                    // console.log(selected);
                    //  d3.select("#the_SVG_ID").remove();
                    //drawBarChart(selected);
                    drawParallelCoordinates(selected, mqpdata);
                })
        }
    </script>
</body>

</html>
